<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>‡¶§‡ßú‡¶ø‡ßé ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡¶ø‡¶ï ‡¶ï‡ßá‡ßü‡¶æ‡¶∞</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Add this in your <head> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<style>
body {font-family: 'Segoe UI', sans-serif; background:#f1f8e9; margin:0}
header {background:#2e7d32;color:#fff;padding:20px;text-align:center}
section {max-width:1100px;margin:20px auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
h2 {color:#1b5e20;border-bottom:2px solid #c8e6c9;padding-bottom:5px}
label {display:block;margin-top:10px;font-weight:bold}
input, select {width:100%;padding:8px;margin-top:5px;border-radius:6px;border:1px solid #ccc}
button {margin-top:15px;padding:10px 18px;background:#388e3c;color:#fff;border:none;border-radius:6px;cursor:pointer}
button:hover {background:#1b5e20}
table {width:100%;border-collapse:collapse;margin-top:15px}
th, td {border:1px solid #ccc;padding:8px;text-align:center}
footer {text-align:center;padding:15px;background:#1b5e20;color:#fff;margin-top:30px}
#charts {display:flex; gap:30px; flex-wrap:wrap; margin-top:20px}
canvas {background:#fff; border-radius:10px; padding:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1)}
.modal {display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;overflow:auto;background:rgba(0,0,0,0.5);}
.modal-content {background:#fff;margin:10% auto;padding:20px;border-radius:10px;width:90%;max-width:600px;position:relative;}
.close {position:absolute;top:10px;right:15px;font-size:24px;font-weight:bold;color:#333;cursor:pointer;}
.attendance-list {max-height:300px;overflow-y:auto;margin-top:10px;border:1px solid #ccc;padding:10px;border-radius:6px;}
.attendance-list div {display:flex;justify-content:space-between;padding:5px 0;}
.attendance-list div:nth-child(odd){background:#f9f9f9;}
.attendance-list button {padding:3px 6px;font-size:12px;}
.payment-btn {cursor:pointer; font-size:18px; border:none; background:none;}
.payment-btn:hover{color:#1b5e20;}
/* Responsive */
@media(max-width:768px){
  table, #charts {overflow-x:auto; display:block;}
  th, td {padding:6px;}
  button {padding:8px 12px;}
}
</style>
</head>
<body>

<header>
<h1>‡¶§‡ßú‡¶ø‡ßé ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡¶ø‡¶ï ‡¶ï‡ßá‡ßü‡¶æ‡¶∞</h1>
<p> ‡¶∏‡¶æ‡¶Æ‡¶∏‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶® ‡¶∏‡¶æ‡¶Æ‡ßÅ ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ </p>
<p>‡¶´‡ßã‡¶®: 01879453612</p>
</header>

<section>
<h2>‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</h2>
<label>‡¶®‡¶æ‡¶Æ</label><input id="name">
<label>‡¶∞‡ßã‡¶≤</label><input id="roll">
<label>‡¶¨‡¶æ‡¶¨‡¶æ/‡¶Æ‡¶æ‡ßü‡ßá‡¶∞ ‡¶´‡ßã‡¶®</label><input id="parent">
<label>‡¶π‡ßã‡ßü‡¶æ‡¶ü‡¶∏‡ßç‡¶Ø‡¶æ‡¶™</label><input id="whatsapp">
<label>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö</label>
<select id="batch">
<option value="A">Batch A (‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø ‡¶∂‡¶®‡¶ø-‡¶∏‡ßã‡¶Æ-‡¶¨‡ßÅ‡¶ß | ‡ß´‚Äì‡ß¨)</option>
<option value="B">Batch B (‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø ‡¶∞‡¶¨‡¶ø-‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤-‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø | ‡ßß‡ßß‚Äì‡ßß‡ß®)</option>
<option value="C">Batch C (‡¶®‡¶¨‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø ‡¶∂‡¶®‡¶ø-‡¶∏‡ßã‡¶Æ-‡¶¨‡ßÅ‡¶ß )</option>
<option value="D">Batch D (‡¶®‡¶¨‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø ‡¶∞‡¶¨‡¶ø-‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤-‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø )</option>
<option value="E">Batch E (‡¶∑‡¶∑‡ßç‡¶† ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø ‡¶∂‡¶®‡¶ø-‡¶∏‡ßã‡¶Æ-‡¶¨‡ßÅ‡¶ß )</option>
<option value="F">Batch F (‡¶∑‡¶∑‡ßç‡¶† ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø ‡¶∞‡¶¨‡¶ø-‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤-‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø )</option>
<option value="G">Batch G (‡¶∏‡¶™‡ßç‡¶§‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø ‡¶∂‡¶®‡¶ø-‡¶∏‡ßã‡¶Æ-‡¶¨‡ßÅ‡¶ß )</option>
<option value="H">Batch H (‡¶∏‡¶™‡ßç‡¶§‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø ‡¶∞‡¶¨‡¶ø-‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤-‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø )</option>
</select>
<button onclick="addStudent(batch)">‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</section>

<section>
<h2>‡¶è‡¶ü‡ßá‡¶®‡ßç‡¶°‡ßá‡¶®‡ßç‡¶∏ ‡¶ì ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
<label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="date">

<div style="margin-top:15px;">
  <button onclick="filterBatch('all')">‡¶∏‡¶¨</button>
  <button onclick="filterBatch('A')"> ‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø / ‡¶∂‡¶®‡¶ø-‡¶∏‡ßã‡¶Æ-‡¶¨‡ßÅ‡¶ß A</button>
  <button onclick="filterBatch('B')">‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø / ‡¶∞‡¶¨‡¶ø-‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤-‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø B</button>
  <button onclick="filterBatch('C')">‡¶®‡¶¨‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø / ‡¶∂‡¶®‡¶ø-‡¶∏‡ßã‡¶Æ-‡¶¨‡ßÅ‡¶ß C</button>
  <button onclick="filterBatch('D')">‡¶®‡¶¨‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø / ‡¶∞‡¶¨‡¶ø-‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤-‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø D</button>
  <button onclick="filterBatch('E')">‡¶∑‡¶∑‡ßç‡¶† ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø / ‡¶∂‡¶®‡¶ø-‡¶∏‡ßã‡¶Æ-‡¶¨‡ßÅ‡¶ß E</button>
  <button onclick="filterBatch('F')">‡¶∑‡¶∑‡ßç‡¶† ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø / ‡¶∞‡¶¨‡¶ø-‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤-‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø F</button>
  <button onclick="filterBatch('G')">‡¶∏‡¶™‡ßç‡¶§‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø / ‡¶∂‡¶®‡¶ø-‡¶∏‡ßã‡¶Æ-‡¶¨‡ßÅ‡¶ß G</button>
  <button onclick="filterBatch('H')">‡¶∏‡¶™‡ßç‡¶§‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶®‡¶ø / ‡¶∞‡¶¨‡¶ø-‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤-‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø H</button>
</div>

<label>‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö</label>
<input type="text" id="searchStudent" placeholder="‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" oninput="searchStudent()">

<table>
<thead>
<tr>
<th>‡¶®‡¶æ‡¶Æ</th>
<th>‡¶∞‡ßã‡¶≤</th>
<th>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö</th>
<th>‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ <button onclick="refreshMonth()">üîÑ</button></th>
<th>‡¶â‡¶™‡¶∏‡ßç‡¶•‡¶ø‡¶§ <button onclick="refreshMonth()">üîÑ</button></th>
<th>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü <button onclick="refreshMonth()">üîÑ</button></th>
<th>‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>

<button onclick="monthlyReport()">‡¶Æ‡¶æ‡¶∏ ‡¶∂‡ßá‡¶∑ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>

<label>‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®:</label>
<select id="chartBatch" onchange="updateChart()">
<option value="A">Batch A</option>
<option value="B">Batch B</option>
</select>

<div id="charts">
<canvas id="chartA" width="400" height="200"></canvas>
<canvas id="chartB" width="400" height="200"></canvas>
</div>
</section>

<section>
<h2>‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶∞‡¶æ</h2>
<table>
<thead>
<tr><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶∞‡ßã‡¶≤</th><th>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö</th><th>‡¶π‡ßã‡ßü‡¶æ‡¶ü‡¶∏‡ßç‡¶Ø‡¶æ‡¶™</th><th>‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</th><th>‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</th></tr>
</thead>
<tbody id="leftTable"></tbody>
</table>
</section>

<footer>
<p>¬© ‡¶§‡ßú‡¶ø‡ßé ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡¶ø‡¶ï ‡¶ï‡ßá‡ßü‡¶æ‡¶∞</p>
</footer>

<!-- Attendance Modal -->
<div id="attendanceModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3 id="modalStudentName"></h3>
    <div class="attendance-list" id="attendanceList"></div>
  </div>
</div>

<!-- Payment Modal -->
<div id="paymentModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closePaymentModal()">&times;</span>
    <h3 id="paymentStudentName"></h3>
    <p>‡¶è‡¶á ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶ø ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶Æ‡ßç‡¶™‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßá‡¶õ‡ßá?</p>
    <button onclick="confirmPayment(true)">‡¶π‡ßç‡¶Ø‡¶æ</button>
    <button onclick="confirmPayment(false)">‡¶®‡¶æ</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const TEACHER_WA = '8801879453612';
let students = JSON.parse(localStorage.getItem('students')) || [];
let leftStudents = JSON.parse(localStorage.getItem('leftStudents')) || [];
// let currentFilter = 'all';
let paymentTargetIndex = null;

// Save
function save(){
  localStorage.setItem('students', JSON.stringify(students));
  localStorage.setItem('leftStudents', JSON.stringify(leftStudents));
}

// Add student
function addStudent(){
  let name = document.getElementById('name').value;
  let roll = document.getElementById('roll').value;
  let parent = document.getElementById('parent').value;
  let whatsapp = document.getElementById('whatsapp').value;
  let batch = document.getElementById('batch').value;
  if(!name || !roll){ alert('‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶∞‡ßã‡¶≤ ‡¶¶‡¶ø‡¶®'); return; }
  let student = {name, roll, parent, whatsapp, batch, classes:0, paid:false, attendance:[]};
  students.push(student); save(); render();
  let msg = '‡¶®‡¶§‡ßÅ‡¶® ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá\n‡¶®‡¶æ‡¶Æ: '+name+'\n‡¶∞‡ßã‡¶≤: '+roll+'\n‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö: '+batch;
  window.open('https://wa.me/'+TEACHER_WA+'?text='+encodeURIComponent(msg), '_blank');
  document.getElementById('name').value=''; document.getElementById('roll').value=''; document.getElementById('parent').value=''; document.getElementById('whatsapp').value='';
  updateChart();
}

let currentFilter = 'all'; 

function filterBatch(batch){
    currentFilter = batch;
    render(); 
}

// Render tables
function render(){
  let table = document.getElementById('table');
  let leftTable = document.getElementById('leftTable');
  table.innerHTML='';
  for(let i=0;i<students.length;i++){
    let s = students[i];
    if(currentFilter !== 'all' && s.batch !== currentFilter) continue;
    let payBtn = `<button class="payment-btn" onclick="openPaymentModal(${i})">${s.paid?' ‚úÖ':'‚úñÔ∏è'}</button>`;
    table.innerHTML += `<tr>
      <td onclick="openModal(${i})" style="cursor:pointer">${s.name}</td>
      <td>${s.roll}</td>
      <td>${s.batch}</td>
      <td>${s.classes}/12</td>
      <td><button onclick="markPresent(${i})">‚úî</button></td>
      <td>${payBtn}</td>
      <td><button onclick="removeStudent(${i})">üóë</button></td>
    </tr>`;
  }
  leftTable.innerHTML='';
  for(let j=0;j<leftStudents.length;j++){
    let ls = leftStudents[j];
    leftTable.innerHTML+='<tr><td>'+ls.name+'</td><td>'+ls.roll+'</td><td>'+ls.batch+'</td><td>'+ls.whatsapp+'</td><td><a target="_blank" href="https://wa.me/'+ls.whatsapp+'">WhatsApp</a></td><td><button onclick="deleteLeftStudent('+j+')">üóë</button></td></tr>';
  }
  updateChart();
}

// Attendance
function markPresent(i){
  let date = document.getElementById('date').value;
  if(!date){ alert('‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶¶‡¶ø‡¶®'); return; }
  if(!students[i].attendance.find(a=>a.date===date)){
    students[i].attendance.push({date, present:true});
  } else {
    students[i].attendance.find(a=>a.date===date).present = true;
  }
  students[i].classes = students[i].attendance.filter(x=>x.present).length;
  save(); render();
}

// Remove / delete
function removeStudent(i){
  if(!confirm('‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) return;
  leftStudents.push(students[i]);
  students.splice(i,1);
  save(); render();
}
function deleteLeftStudent(i){
  if(!confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶á ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) return;
  leftStudents.splice(i,1);
  save(); render();
}

// Refresh month
function refreshMonth(){
  if(!confirm('‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§? ‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡¶æ‡¶∏ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶¨ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏, ‡¶â‡¶™‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø ‡¶ì ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶π‡¶¨‡ßá‡•§')) return;
  students.forEach(s=>{
    s.classes = 0;
    s.paid = false;
    s.attendance = [];
  });
  save(); render(); updateChart();
}
// ---------------------------------------------------------------------

async function monthlyReport() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFont("helvetica", "normal"); // works for Bengali in most browsers
  doc.setFontSize(16);
  doc.text('‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü - ‡¶§‡ßú‡¶ø‡ßé ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡¶ø‡¶ï ‡¶ï‡ßá‡ßü‡¶æ‡¶∞', 10, 15);

  // Table headers
  const headers = [['‡¶®‡¶æ‡¶Æ', '‡¶∞‡ßã‡¶≤', '‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö', '‡¶ï‡ßç‡¶≤‡¶æ‡¶∏', '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü']];

  // Table data
  const data = students.map(s => [
    s.name,
    s.roll,
    s.batch,
    `${s.classes}/12`,
    s.paid ? '‡¶π‡ßç‡¶Ø‡¶æ' : '‡¶®‡¶æ'
  ]);

  // Use autoTable plugin
  doc.autoTable({
    startY: 25,
    head: headers,
    body: data,
    styles: { font: 'helvetica', fontSize: 12 },
    headStyles: { fillColor: [46, 125, 50], textColor: 255 },
    alternateRowStyles: { fillColor: [240, 248, 233] }
  });

  doc.save('monthly_report.pdf');
}
// --------------------------------------

// --------------------------------------------------------------------
// Monthly report
async function monthlyReport(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text('‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü - ‡¶§‡ßú‡¶ø‡ßé ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡¶ø‡¶ï ‡¶ï‡ßá‡ßü‡¶æ‡¶∞', 10, 15);
  doc.setFontSize(12);
  let y = 25;
  doc.text('‡¶®‡¶æ‡¶Æ | ‡¶∞‡ßã‡¶≤ | ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö | ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ | ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü', 10, y);
  
  y+=5;
  students.forEach(s=>{
    let text = `${s.name} | ${s.roll} | ${s.batch} | ${s.classes} | ${s.paid?'‡¶π‡ßç‡¶Ø‡¶æ':'‡¶®‡¶æ'}`;
    doc.text(text, 10, y);
    y+=7;
  });
  doc.save('monthly_report.pdf');
}
// -----------------------------------------------------------------------
// Chart.js
var ctxA = document.getElementById('chartA').getContext('2d');
var ctxB = document.getElementById('chartB').getContext('2d');
var chartA = new Chart(ctxA,{type:'bar',data:{labels:[],datasets:[{label:'Batch A Classes',data:[],backgroundColor:'rgba(75, 192, 192, 0.6)'}]},options:{responsive:true}});
var chartB = new Chart(ctxB,{type:'bar',data:{labels:[],datasets:[{label:'Batch B Classes',data:[],backgroundColor:'rgba(153, 102, 255, 0.6)'}]},options:{responsive:true}});

function updateChart(){
  let batchSel = document.getElementById('chartBatch').value;
  let labelsA=[], dataA=[], labelsB=[], dataB=[];
  students.forEach(s=>{
    if(s.batch==='A'){labelsA.push(s.name); dataA.push(s.classes);} 
    else{labelsB.push(s.name); dataB.push(s.classes);}
  });
  chartA.data.labels=labelsA; chartA.data.datasets[0].data=dataA; chartA.update();
  chartB.data.labels=labelsB; chartB.data.datasets[0].data=dataB; chartB.update();
  document.getElementById('chartA').style.display = batchSel==='A'?'block':'none';
  document.getElementById('chartB').style.display = batchSel==='B'?'block':'none';
}

// Student search
function searchStudent(){
  let query = document.getElementById('searchStudent').value.toLowerCase();
  if(!query) return;
  let student = students.find(s=>s.name.toLowerCase().includes(query));
  if(student) openModal(students.indexOf(student));
}

// Attendance modal
function openModal(index){
  let student = students[index];
  document.getElementById('attendanceModal').style.display='block';
  document.getElementById('modalStudentName').innerText = student.name+' ‡¶è‡¶∞ ‡¶è‡¶ü‡ßá‡¶®‡ßç‡¶°‡ßá‡¶®‡ßç‡¶∏';
  let list = document.getElementById('attendanceList');
  list.innerHTML='';

  if(student.classes===0){
    list.innerHTML='<p>‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡ßü‡¶®‡¶ø‡•§</p>';
    return;
  }

  student.attendance.forEach((a,index)=>{
    let div = document.createElement('div');
    div.innerHTML = `<span>${a.date}</span><span>${a.present ? '‚úî ‡¶â‡¶™‡¶∏‡ßç‡¶•‡¶ø‡¶§':'‚úñ ‡¶Ö‡¶®‡ßÅ‡¶™‡¶∏‡ßç‡¶•‡¶ø‡¶§'}</span>`;
    let btn = document.createElement('button');
    //  ‚úñÔ∏è‚ùå‚ÄºÔ∏è ‚úÖ‚òëÔ∏è‚úîÔ∏è
    btn.innerText = a.present ? 'X' : '‚úî';
    btn.onclick = ()=>{
      student.attendance[index].present = !student.attendance[index].present;
      student.classes = student.attendance.filter(x=>x.present).length;
      save(); render(); openModal(index);
    };
    div.appendChild(btn);
    list.appendChild(div);
  });
}
function closeModal(){document.getElementById('attendanceModal').style.display='none';}

// Payment modal
function openPaymentModal(index){
  paymentTargetIndex = index;
  document.getElementById('paymentStudentName').innerText = students[index].name;
  document.getElementById('paymentModal').style.display='block';
}
function closePaymentModal(){document.getElementById('paymentModal').style.display='none';}
function confirmPayment(isPaid){
  students[paymentTargetIndex].paid = isPaid;
  save(); render(); closePaymentModal();
}

render();
updateChart();
</script>
</body>
</html>
