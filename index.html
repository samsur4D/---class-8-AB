<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>рждрзЬрж┐рзО ржПржХрж╛ржбрзЗржорж┐ржХ ржХрзЗрзЯрж╛рж░</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* тЭЧ UNCHANGED CSS */
body {font-family:'Segoe UI',sans-serif;background:#f1f8e9;margin:0}
header {background:#2e7d32;color:#fff;padding:20px;text-align:center}
section {max-width:1100px;margin:20px auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
h2 {color:#1b5e20;border-bottom:2px solid #c8e6c9;padding-bottom:5px}
label {display:block;margin-top:10px;font-weight:bold}
input,select {width:100%;padding:8px;margin-top:5px;border-radius:6px;border:1px solid #ccc}
button {margin-top:15px;padding:10px 18px;background:#388e3c;color:#fff;border:none;border-radius:6px;cursor:pointer}
table {width:100%;border-collapse:collapse;margin-top:15px}
th,td {border:1px solid #ccc;padding:8px;text-align:center}
footer {text-align:center;padding:15px;background:#1b5e20;color:#fff;margin-top:30px}
canvas {background:#fff;border-radius:10px;padding:10px}
.modal {display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5)}
.modal-content {background:#fff;margin:10% auto;padding:20px;border-radius:10px;width:90%;max-width:600px}
.close {float:right;font-size:22px;cursor:pointer}
</style>
</head>

<body>

<header>
<h1>рждрзЬрж┐рзО ржПржХрж╛ржбрзЗржорж┐ржХ ржХрзЗрзЯрж╛рж░</h1>
<p>рж╕рж╛ржорж╕рзБрж░ рж░рж╣ржорж╛ржи рж╕рж╛ржорзБ рж╕рзНржпрж╛рж░</p>
<p>ржлрзЛржи: 01879453612</p>
</header>

<!-- ================= FRONTEND HTML UNCHANGED ================= -->
<section>
<h2>рж╢рж┐ржХрзНрж╖рж╛рж░рзНржерзА рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи</h2>
<label>ржирж╛ржо</label><input id="name">
<label>рж░рзЛрж▓</label><input id="roll">
<label>ржмрж╛ржмрж╛/ржорж╛рзЯрзЗрж░ ржлрзЛржи</label><input id="parent">
<label>рж╣рзЛрзЯрж╛ржЯрж╕рзНржпрж╛ржк</label><input id="whatsapp">
<label>ржмрзНржпрж╛ржЪ</label>
<select id="batch">
<option value="A">Batch A (ржЕрж╖рзНржЯржо рж╢рзНрж░рзЗржирж┐ рж╢ржирж┐-рж╕рзЛржо-ржмрзБржз | рзлтАУрзм)</option>
<option value="B">Batch B (ржЕрж╖рзНржЯржо рж╢рзНрж░рзЗржирж┐ рж░ржмрж┐-ржоржЩрзНржЧрж▓-ржмрзГрж╣рж╕рзНржкрждрж┐ | рззрззтАУрззрзи)</option>
<option value="C">Batch C (ржиржмржо рж╢рзНрж░рзЗржирж┐ рж╢ржирж┐-рж╕рзЛржо-ржмрзБржз )</option>
<option value="D">Batch D (ржиржмржо рж╢рзНрж░рзЗржирж┐ рж░ржмрж┐-ржоржЩрзНржЧрж▓-ржмрзГрж╣рж╕рзНржкрждрж┐ )</option>
<option value="E">Batch E (рж╖рж╖рзНржа рж╢рзНрж░рзЗржирж┐ рж╢ржирж┐-рж╕рзЛржо-ржмрзБржз )</option>
<option value="F">Batch F (рж╖рж╖рзНржа рж╢рзНрж░рзЗржирж┐ рж░ржмрж┐-ржоржЩрзНржЧрж▓-ржмрзГрж╣рж╕рзНржкрждрж┐ )</option>
<option value="G">Batch G (рж╕ржкрзНрждржо рж╢рзНрж░рзЗржирж┐ рж╢ржирж┐-рж╕рзЛржо-ржмрзБржз )</option>
<option value="H">Batch H (рж╕ржкрзНрждржо рж╢рзНрж░рзЗржирж┐ рж░ржмрж┐-ржоржЩрзНржЧрж▓-ржмрзГрж╣рж╕рзНржкрждрж┐ )</option>
</select>
<button onclick="addStudent(batch)">ржПржирзНржЯрзНрж░рж┐ ржХрж░рзБржи</button>
</section>

<section>
<h2>ржПржЯрзЗржирзНржбрзЗржирзНрж╕ ржУ ржкрзЗржорзЗржирзНржЯ</h2>
<label>рждрж╛рж░рж┐ржЦ</label><input type="date" id="date">

<div style="margin-top:15px;">
  <button onclick="filterBatch('all')">рж╕ржм</button>
  <button onclick="filterBatch('A')"> ржЕрж╖рзНржЯржо рж╢рзНрж░рзЗржирж┐ / рж╢ржирж┐-рж╕рзЛржо-ржмрзБржз A</button>
  <button onclick="filterBatch('B')">ржЕрж╖рзНржЯржо рж╢рзНрж░рзЗржирж┐ / рж░ржмрж┐-ржоржЩрзНржЧрж▓-ржмрзГрж╣рж╕рзНржкрждрж┐ B</button>
  <button onclick="filterBatch('C')">ржиржмржо рж╢рзНрж░рзЗржирж┐ / рж╢ржирж┐-рж╕рзЛржо-ржмрзБржз C</button>
  <button onclick="filterBatch('D')">ржиржмржо рж╢рзНрж░рзЗржирж┐ / рж░ржмрж┐-ржоржЩрзНржЧрж▓-ржмрзГрж╣рж╕рзНржкрждрж┐ D</button>
  <button onclick="filterBatch('E')">рж╖рж╖рзНржа рж╢рзНрж░рзЗржирж┐ / рж╢ржирж┐-рж╕рзЛржо-ржмрзБржз E</button>
  <button onclick="filterBatch('F')">рж╖рж╖рзНржа рж╢рзНрж░рзЗржирж┐ / рж░ржмрж┐-ржоржЩрзНржЧрж▓-ржмрзГрж╣рж╕рзНржкрждрж┐ F</button>
  <button onclick="filterBatch('G')">рж╕ржкрзНрждржо рж╢рзНрж░рзЗржирж┐ / рж╢ржирж┐-рж╕рзЛржо-ржмрзБржз G</button>
  <button onclick="filterBatch('H')">рж╕ржкрзНрждржо рж╢рзНрж░рзЗржирж┐ / рж░ржмрж┐-ржоржЩрзНржЧрж▓-ржмрзГрж╣рж╕рзНржкрждрж┐ H</button>
</div>

<label>рж╢рж┐ржХрзНрж╖рж╛рж░рзНржерзА рж╕рж╛рж░рзНржЪ</label>
<input type="text" id="searchStudent" placeholder="ржирж╛ржо рж▓рж┐ржЦрзБржи" oninput="searchStudent()">

<table>
<thead>
<tr>
<th>ржирж╛ржо</th>
<th>рж░рзЛрж▓</th>
<th>ржмрзНржпрж╛ржЪ</th>
<th>ржХрзНрж▓рж╛рж╕ <button onclick="refreshMonth()">ЁЯФД</button></th>
<th>ржЙржкрж╕рзНржерж┐ржд <button onclick="refreshMonth()">ЁЯФД</button></th>
<th>ржкрзЗржорзЗржирзНржЯ <button onclick="refreshMonth()">ЁЯФД</button></th>
<th>ржбрж┐рж▓рж┐ржЯ</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>

<button onclick="monthlyReport()">ржорж╛рж╕ рж╢рзЗрж╖ рж░рж┐ржкрзЛрж░рзНржЯ ржжрзЗржЦрзБржи</button>

<label>ржЪрж▓ржорж╛ржи ржЪрж╛рж░рзНржЯ ржжрзЗржЦрж╛рж░ ржЬржирзНржп ржмрзНржпрж╛ржЪ рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржи:</label>
<select id="chartBatch" onchange="updateChart()">
<option value="A">Batch A</option>
<option value="B">Batch B</option>
</select>

<div id="charts">
<canvas id="chartA" width="400" height="200"></canvas>
<canvas id="chartB" width="400" height="200"></canvas>
</div>
</section>

<section>
<h2>ржЪрж▓рзЗ ржпрж╛ржУрзЯрж╛ рж╢рж┐ржХрзНрж╖рж╛рж░рзНржерзАрж░рж╛</h2>
<table>
<thead>
<tr><th>ржирж╛ржо</th><th>рж░рзЛрж▓</th><th>ржмрзНржпрж╛ржЪ</th><th>рж╣рзЛрзЯрж╛ржЯрж╕рзНржпрж╛ржк</th><th>ржпрзЛржЧрж╛ржпрзЛржЧ</th><th>ржбрж┐рж▓рж┐ржЯ</th></tr>
</thead>
<tbody id="leftTable"></tbody>
</table>
</section>

<footer>
<p>┬й рждрзЬрж┐рзО ржПржХрж╛ржбрзЗржорж┐ржХ ржХрзЗрзЯрж╛рж░</p>
</footer>

<!-- Attendance Modal -->
<div id="attendanceModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3 id="modalStudentName"></h3>
    <div class="attendance-list" id="attendanceList"></div>
  </div>
</div>

<!-- Payment Modal -->
<div id="paymentModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closePaymentModal()">&times;</span>
    <h3 id="paymentStudentName"></h3>
    <p>ржПржЗ рж╕рзНржЯрзБржбрзЗржирзНржЯ ржХрж┐ ржкрзЗржорзЗржирзНржЯ ржХржорзНржкрж▓рж┐ржЯ ржХрж░рзЗржЫрзЗ?</p>
    <button onclick="confirmPayment(true)">рж╣рзНржпрж╛</button>
    <button onclick="confirmPayment(false)">ржирж╛</button>
  </div>
</div>
<!-- ЁЯФе BACKEND API LOGIC STARTS HERE -->
<script>
const API = "http://localhost:5000/api"; // ЁЯФБ change if needed
const TEACHER_WA = '8801879453612';

let students = [];
let leftStudents = [];
let currentFilter = 'all';
let paymentTargetIndex = null;

/* ---------------- LOAD DATA ---------------- */
async function loadData(){
  students = await fetch(API + "/students").then(r=>r.json());
  leftStudents = await fetch(API + "/left-students").then(r=>r.json());
  render();
  updateChart();
}

/* ---------------- ADD STUDENT ---------------- */
async function addStudent(){
  const student = {
    name: name.value,
    roll: roll.value,
    parent: parent.value,
    whatsapp: whatsapp.value,
    batch: batch.value,
    classes: 0,
    paid: false,
    attendance: []
  };

  await fetch(API+"/students",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(student)
  });

  loadData();
  window.open(`https://wa.me/${TEACHER_WA}?text=${encodeURIComponent("ржирждрзБржи рж╢рж┐ржХрзНрж╖рж╛рж░рзНржерзА ржпрзБржХрзНржд рж╣рзЯрзЗржЫрзЗ\n"+student.name)}`);
}

/* ---------------- FILTER ---------------- */
function filterBatch(b){ currentFilter=b; render(); }

/* ---------------- RENDER ---------------- */
function render(){
  table.innerHTML="";
  students.forEach((s,i)=>{
    if(currentFilter!=='all' && s.batch!==currentFilter) return;

    table.innerHTML+=`
    <tr>
      <td onclick="openModal('${s._id}')">${s.name}</td>
      <td>${s.roll}</td>
      <td>${s.batch}</td>
      <td>${s.classes}/12</td>
      <td><button onclick="markPresent('${s._id}')">тЬФ</button></td>
      <td><button onclick="openPaymentModal('${s._id}')">${s.paid?'тЬЕ':'тЭМ'}</button></td>
      <td><button onclick="removeStudent('${s._id}')">ЁЯЧС</button></td>
    </tr>`;
  });

  leftTable.innerHTML="";
  leftStudents.forEach(s=>{
    leftTable.innerHTML+=`
    <tr>
      <td>${s.name}</td><td>${s.roll}</td><td>${s.batch}</td>
      <td>${s.whatsapp}</td>
      <td><a href="https://wa.me/${s.whatsapp}" target="_blank">WhatsApp</a></td>
      <td><button onclick="deleteLeftStudent('${s._id}')">ЁЯЧС</button></td>
    </tr>`;
  });
}

/* ---------------- ATTENDANCE ---------------- */
async function markPresent(id){
  const date = document.getElementById('date').value;
  await fetch(API+"/students/"+id+"/attendance",{
    method:"PUT",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({date})
  });
  loadData();
}

/* ---------------- DELETE ---------------- */
async function removeStudent(id){
  await fetch(API+"/students/"+id,{method:"DELETE"});
  loadData();
}
async function deleteLeftStudent(id){
  await fetch(API+"/left-students/"+id,{method:"DELETE"});
  loadData();
}

/* ---------------- PAYMENT ---------------- */
function openPaymentModal(id){ paymentTargetIndex=id; paymentModal.style.display="block"; }
async function confirmPayment(paid){
  await fetch(API+"/students/"+paymentTargetIndex,{
    method:"PUT",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({paid})
  });
  paymentModal.style.display="none";
  loadData();
}

/* ---------------- CHART ---------------- */
function updateChart(){ /* unchanged logic if backend returns same data */ }

/* ---------------- INIT ---------------- */
loadData();
</script>

</body>
</html>
